<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Test a Training Protocol" href="test.html"><link rel="prev" title="Use an Existing Training Protocol" href="use.html">
        <link rel="canonical" href="https://BrainCircuitsBehaviorLab.github.io/village/user_guide/create.html">
        <link rel="prefetch" href="../_static/logo.png" as="image">

    <link rel="shortcut icon" href="../_static/favicon.svg"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Create a Training Protocol - Training village</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Training village</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../user_guide_index.html">User Guide</a><input aria-label="Toggle navigation of User Guide" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="animal_procedures.html">Animal Procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="GUI.html">GUI Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">Initial Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="subjects.html">Create New Subjects</a></li>
<li class="toctree-l2"><a class="reference internal" href="corridor.html">Calibrate and Test Corridor Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="detection.html">Calibrate and Test Animal Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="use.html">Use an Existing Training Protocol</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Create a Training Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Test a Training Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="plots.html">Create Real-Time Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Saved Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="state_machine.html">System State Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="alarms.html">Receive and Respond to Telegram Alarms</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintenance.html">Maintenance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../how_to_build_index.html">How to Build It</a><input aria-label="Toggle navigation of How to Build It" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../how_to_build/list_of_parts.html">List of Parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to_build/assembly_instructions.html">Assembly Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to_build/software_installation.html">Software Installation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../initial_configuration_index.html">Initial Configuration</a><input aria-label="Toggle navigation of Initial Configuration" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../initial_configuration/hardware.html">Hardware Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initial_configuration/remote.html">Configure Remote Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initial_configuration/telegram.html">Create a Telegram Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initial_configuration/backup.html">Schedule Backups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initial_configuration/heartbeat.html">Send Heartbeat Signals to a Remote Device</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_index.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_generated/village.devices.html">devices</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_generated/village.classes.html">classes</a><input aria-label="Toggle navigation of classes" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.classes.enums.html">enums</a><input aria-label="Toggle navigation of enums" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Actions.html">Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Active.html">Active</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.AreaActive.html">AreaActive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Color.html">Color</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Controller.html">Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Cycle.html">Cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.DataTable.html">DataTable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Info.html">Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.Save.html">Save</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.ScreenActive.html">ScreenActive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.State.html">State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.SuperEnum.html">SuperEnum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.enums.SyncType.html">SyncType</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.classes.settings_class.html">settings_class</a><input aria-label="Toggle navigation of settings_class" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.settings_class.Setting.html">Setting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.classes.settings_class.Settings.html">Settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_generated/village.gui.html">gui</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.html">pybpodapi</a><input aria-label="Toggle navigation of pybpodapi" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.html">bpod</a><input aria-label="Toggle navigation of bpod" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.Bpod.html">Bpod</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_base.html">bpod_base</a><input aria-label="Toggle navigation of bpod_base" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_base.BpodBase.html">BpodBase</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_com_protocol.html">bpod_com_protocol</a><input aria-label="Toggle navigation of bpod_com_protocol" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_com_protocol.BpodCOMProtocol.html">BpodCOMProtocol</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_com_protocol_modules.html">bpod_com_protocol_modules</a><input aria-label="Toggle navigation of bpod_com_protocol_modules" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_com_protocol_modules.BpodCOMProtocolModules.html">BpodCOMProtocolModules</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_io.html">bpod_io</a><input aria-label="Toggle navigation of bpod_io" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.bpod_io.BpodIO.html">BpodIO</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.html">hardware</a><input aria-label="Toggle navigation of hardware" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.channels.html">channels</a><input aria-label="Toggle navigation of channels" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.channels.ChannelName.html">ChannelName</a></li>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.channels.ChannelType.html">ChannelType</a></li>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.channels.Channels.html">Channels</a></li>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.channels.EventsPositions.html">EventsPositions</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.events.html">events</a><input aria-label="Toggle navigation of events" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.events.base_eventname.html">base_eventname</a><input aria-label="Toggle navigation of base_eventname" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.events.base_eventname.BaseEventName.html">BaseEventName</a></li>
</ul>
</li>
<li class="toctree-l6 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.events.bpod_events.html">bpod_events</a><input aria-label="Toggle navigation of bpod_events" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.events.bpod_events.EventName.html">EventName</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.hardware.html">hardware</a><input aria-label="Toggle navigation of hardware" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.hardware.Hardware.html">Hardware</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.input_channels.html">input_channels</a><input aria-label="Toggle navigation of input_channels" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.input_channels.bpod_input_channels.html">bpod_input_channels</a><input aria-label="Toggle navigation of bpod_input_channels" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.input_channels.bpod_input_channels.InputName.html">InputName</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.output_channels.html">output_channels</a><input aria-label="Toggle navigation of output_channels" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.output_channels.bpod_output_channels.html">bpod_output_channels</a><input aria-label="Toggle navigation of bpod_output_channels" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.hardware.output_channels.bpod_output_channels.OutputChannel.html">OutputChannel</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingsocketreceive.html">non_blockingsocketreceive</a><input aria-label="Toggle navigation of non_blockingsocketreceive" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingsocketreceive.NonBlockingSocketReceive.html">NonBlockingSocketReceive</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingsocketreceive.UnexpectedEndOfStream.html">village.pybpodapi.bpod.non_blockingsocketreceive.UnexpectedEndOfStream</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingstreamreader.html">non_blockingstreamreader</a><input aria-label="Toggle navigation of non_blockingstreamreader" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingstreamreader.NonBlockingStreamReader.html">NonBlockingStreamReader</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.non_blockingstreamreader.UnexpectedEndOfStream.html">village.pybpodapi.bpod.non_blockingstreamreader.UnexpectedEndOfStream</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod.settings.html">settings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod_modules.html">bpod_modules</a><input aria-label="Toggle navigation of bpod_modules" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod_modules.bpod_module.html">bpod_module</a><input aria-label="Toggle navigation of bpod_module" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod_modules.bpod_module.BpodModule.html">BpodModule</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod_modules.bpod_modules.html">bpod_modules</a><input aria-label="Toggle navigation of bpod_modules" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.bpod_modules.bpod_modules.BpodModules.html">BpodModules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.html">com</a><input aria-label="Toggle navigation of com" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.arcom.html">arcom</a><input aria-label="Toggle navigation of arcom" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.com.arcom.ArCOM.html">ArCOM</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.com.arcom.ArduinoTypes.html">ArduinoTypes</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.com.arcom.DataType.html">DataType</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.html">messaging</a><input aria-label="Toggle navigation of messaging" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.base_message.html">base_message</a><input aria-label="Toggle navigation of base_message" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.base_message.BaseMessage.html">BaseMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.debug.html">debug</a><input aria-label="Toggle navigation of debug" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.debug.DebugMessage.html">DebugMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.end_trial.html">end_trial</a><input aria-label="Toggle navigation of end_trial" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.end_trial.EndTrial.html">EndTrial</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.error.html">error</a><input aria-label="Toggle navigation of error" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.error.ErrorMessage.html">ErrorMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.event_occurrence.html">event_occurrence</a><input aria-label="Toggle navigation of event_occurrence" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.event_occurrence.EventOccurrence.html">EventOccurrence</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.event_resume.html">event_resume</a><input aria-label="Toggle navigation of event_resume" class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.event_resume.EventResume.html">EventResume</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.parser.html">parser</a><input aria-label="Toggle navigation of parser" class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.parser.MessageParser.html">MessageParser</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.session_info.html">session_info</a><input aria-label="Toggle navigation of session_info" class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.session_info.SessionInfo.html">SessionInfo</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.softcode_occurrence.html">softcode_occurrence</a><input aria-label="Toggle navigation of softcode_occurrence" class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.softcode_occurrence.SoftcodeOccurrence.html">SoftcodeOccurrence</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.state_occurrence.html">state_occurrence</a><input aria-label="Toggle navigation of state_occurrence" class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.state_occurrence.StateOccurrence.html">StateOccurrence</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.state_transition.html">state_transition</a><input aria-label="Toggle navigation of state_transition" class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.state_transition.StateTransition.html">StateTransition</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.stderr.html">stderr</a><input aria-label="Toggle navigation of stderr" class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.stderr.StderrMessage.html">StderrMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.stdout.html">stdout</a><input aria-label="Toggle navigation of stdout" class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.stdout.StdoutMessage.html">StdoutMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.trial.html">trial</a><input aria-label="Toggle navigation of trial" class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.trial.Trial.html">Trial</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.untagged_message.html">untagged_message</a><input aria-label="Toggle navigation of untagged_message" class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.untagged_message.UntaggedMessage.html">UntaggedMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.value.html">value</a><input aria-label="Toggle navigation of value" class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" role="switch" type="checkbox"/><label for="toctree-checkbox-47"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.value.ValueMessage.html">ValueMessage</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.warning.html">warning</a><input aria-label="Toggle navigation of warning" class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" role="switch" type="checkbox"/><label for="toctree-checkbox-48"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.messaging.warning.WarningMessage.html">WarningMessage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.protocol.html">protocol</a><input aria-label="Toggle navigation of protocol" class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" role="switch" type="checkbox"/><label for="toctree-checkbox-49"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.protocol.recv_msg_headers.html">recv_msg_headers</a><input aria-label="Toggle navigation of recv_msg_headers" class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" role="switch" type="checkbox"/><label for="toctree-checkbox-50"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.protocol.recv_msg_headers.ReceiveMessageHeader.html">ReceiveMessageHeader</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.protocol.send_msg_headers.html">send_msg_headers</a><input aria-label="Toggle navigation of send_msg_headers" class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" role="switch" type="checkbox"/><label for="toctree-checkbox-51"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../api_generated/village.pybpodapi.com.protocol.send_msg_headers.SendMessageHeader.html">SendMessageHeader</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.stderr_buffer.html">stderr_buffer</a><input aria-label="Toggle navigation of stderr_buffer" class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" role="switch" type="checkbox"/><label for="toctree-checkbox-52"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.com.stderr_buffer.StderrBuffer.html">StderrBuffer</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.com.stdout_buffer.html">stdout_buffer</a><input aria-label="Toggle navigation of stdout_buffer" class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" role="switch" type="checkbox"/><label for="toctree-checkbox-53"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.com.stdout_buffer.StdoutBuffer.html">StdoutBuffer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.exceptions.html">exceptions</a><input aria-label="Toggle navigation of exceptions" class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" role="switch" type="checkbox"/><label for="toctree-checkbox-54"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.exceptions.bpod_error.html">bpod_error</a><input aria-label="Toggle navigation of bpod_error" class="toctree-checkbox" id="toctree-checkbox-55" name="toctree-checkbox-55" role="switch" type="checkbox"/><label for="toctree-checkbox-55"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.exceptions.bpod_error.BpodErrorException.html">village.pybpodapi.exceptions.bpod_error.BpodErrorException</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api_generated/village.pybpodapi.protocol.html">protocol</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.session.html">session</a><input aria-label="Toggle navigation of session" class="toctree-checkbox" id="toctree-checkbox-56" name="toctree-checkbox-56" role="switch" type="checkbox"/><label for="toctree-checkbox-56"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.pybpodapi.session.Session.html">Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.pybpodapi.session.StreamsWrapper.html">StreamsWrapper</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.html">state_machine</a><input aria-label="Toggle navigation of state_machine" class="toctree-checkbox" id="toctree-checkbox-57" name="toctree-checkbox-57" role="switch" type="checkbox"/><label for="toctree-checkbox-57"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.StateMachine.html">StateMachine</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.conditions.html">conditions</a><input aria-label="Toggle navigation of conditions" class="toctree-checkbox" id="toctree-checkbox-58" name="toctree-checkbox-58" role="switch" type="checkbox"/><label for="toctree-checkbox-58"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.conditions.Conditions.html">Conditions</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.global_counters.html">global_counters</a><input aria-label="Toggle navigation of global_counters" class="toctree-checkbox" id="toctree-checkbox-59" name="toctree-checkbox-59" role="switch" type="checkbox"/><label for="toctree-checkbox-59"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.global_counters.GlobalCounters.html">GlobalCounters</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.global_timers.html">global_timers</a><input aria-label="Toggle navigation of global_timers" class="toctree-checkbox" id="toctree-checkbox-60" name="toctree-checkbox-60" role="switch" type="checkbox"/><label for="toctree-checkbox-60"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.global_timers.GlobalTimers.html">GlobalTimers</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_base.html">state_machine_base</a><input aria-label="Toggle navigation of state_machine_base" class="toctree-checkbox" id="toctree-checkbox-61" name="toctree-checkbox-61" role="switch" type="checkbox"/><label for="toctree-checkbox-61"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_base.StateMachineBase.html">StateMachineBase</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_base.SMAError.html">village.pybpodapi.state_machine.state_machine_base.SMAError</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_builder.html">state_machine_builder</a><input aria-label="Toggle navigation of state_machine_builder" class="toctree-checkbox" id="toctree-checkbox-62" name="toctree-checkbox-62" role="switch" type="checkbox"/><label for="toctree-checkbox-62"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_builder.StateMachineBuilder.html">StateMachineBuilder</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_builder.StateMachineBuilderError.html">village.pybpodapi.state_machine.state_machine_builder.StateMachineBuilderError</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_runner.html">state_machine_runner</a><input aria-label="Toggle navigation of state_machine_runner" class="toctree-checkbox" id="toctree-checkbox-63" name="toctree-checkbox-63" role="switch" type="checkbox"/><label for="toctree-checkbox-63"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_runner.StateMachineRunner.html">StateMachineRunner</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.state_machine.state_machine_runner.StateMachineRunnerError.html">village.pybpodapi.state_machine.state_machine_runner.StateMachineRunnerError</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.html">utils</a><input aria-label="Toggle navigation of utils" class="toctree-checkbox" id="toctree-checkbox-64" name="toctree-checkbox-64" role="switch" type="checkbox"/><label for="toctree-checkbox-64"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.csv.html">csv</a><input aria-label="Toggle navigation of csv" class="toctree-checkbox" id="toctree-checkbox-65" name="toctree-checkbox-65" role="switch" type="checkbox"/><label for="toctree-checkbox-65"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.csv.Reader.html">Reader</a></li>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.csv.Writer.html">Writer</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.date_parser.html">date_parser</a><input aria-label="Toggle navigation of date_parser" class="toctree-checkbox" id="toctree-checkbox-66" name="toctree-checkbox-66" role="switch" type="checkbox"/><label for="toctree-checkbox-66"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../api_generated/village.pybpodapi.utils.date_parser.parse.html">parse</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_generated/village.screen.html">screen</a><input aria-label="Toggle navigation of screen" class="toctree-checkbox" id="toctree-checkbox-67" name="toctree-checkbox-67" role="switch" type="checkbox"/><label for="toctree-checkbox-67"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api_generated/village.screen.video_worker.html">video_worker</a><input aria-label="Toggle navigation of video_worker" class="toctree-checkbox" id="toctree-checkbox-68" name="toctree-checkbox-68" role="switch" type="checkbox"/><label for="toctree-checkbox-68"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_generated/village.screen.video_worker.VideoWorker.html">VideoWorker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../resources_index.html">Resources</a><input aria-label="Toggle navigation of Resources" class="toctree-checkbox" id="toctree-checkbox-69" name="toctree-checkbox-69" role="switch" type="checkbox"/><label for="toctree-checkbox-69"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources/print_files.html">3D Printing Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources/ISO.html">System ISO Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources/code.html">Code Repository</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq_index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting_index.html">Troubleshooting</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/user_guide/create.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="create-a-training-protocol">
<h1>Create a Training Protocol</h1>
<section id="project-structure">
<h2>Project Structure</h2>
<p>For training animals, the code and data are organized into projects. A projects
structure is
automatically created when a new project is started.</p>
<p>A folder is created for the project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">village</span><span class="o">/</span><span class="n">village_projects</span><span class="o">/</span><span class="n">name_of_the_project</span><span class="o">/</span>
</pre></div>
</div>
<p>Within this folder, there are two subfolders:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">data</span>    <span class="c1"># Stores all experimental data</span>
<span class="o">/</span><span class="n">code</span>    <span class="c1"># Contains all task scripts and the training protocol</span>
</pre></div>
</div>
<p>The first time you run Training Village, it will automatically create a project called <code class="docutils literal notranslate"><span class="pre">demo_project</span></code>.
It will also clone the <a class="reference external" href="https://github.com/BrainCircuitsBehaviorLab/follow-the-light-task">follow-the-light-task</a> repository,
which contains a working example for a simple project. You can use it as a base to start creating your own tasks.</p>
</section>
<section id="code-organization">
<h2>Code Organization</h2>
<p>A training protocol consists of one or more Python scripts, each representing a task that the animals can perform. In addition to
these scripts, a training script is required (called <code class="docutils literal notranslate"><span class="pre">training_protocol.py</span></code>).</p>
<p>The training script is run every time a subject finishes a task and contains the logic to either advance or regress the subject in
their training based on their performance. This could involve changing the animal to a different task and/or modifying the
parameters used in the task.</p>
<section id="examples-of-code-structure">
<h3>Examples of Code Structure</h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example 1: Multiple sequential tasks
code/
 habituation.py
 lick_teaching.py
 simple_task.py
 final_task.py
 training_protocol.py
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example 2: One task with progressive difficulty
code/
 behavioral_task.py
 training_protocol.py
</pre></div>
</div>
<p>In Example 1, there are several tasks corresponding to different training stages:</p>
<ol class="arabic simple">
<li><p>Animals start with <code class="docutils literal notranslate"><span class="pre">habituation</span></code>, a simple task that helps them get used to the behavioral box</p></li>
<li><p>After one or two sessions, they move on to <code class="docutils literal notranslate"><span class="pre">lick_teaching</span></code>, where they learn to lick the behavioral ports</p></li>
<li><p>Once they have completed a sufficient number of trials, they progress to <code class="docutils literal notranslate"><span class="pre">simple_task</span></code>, a simplified version of the final task</p></li>
<li><p>When performance reaches an adequate level, they transition to <code class="docutils literal notranslate"><span class="pre">final_task</span></code></p></li>
</ol>
<p>In Example 2, there is only one task, <code class="docutils literal notranslate"><span class="pre">behavioral_task</span></code>, but each time a subject finishes a session, <code class="docutils literal notranslate"><span class="pre">training_protocol.py</span></code> adjusts
variables to increase the tasks difficulty.</p>
<p>The user can choose either approach to organize the training as needed. In our example we
use a combination of both approaches, we have 2 tasks: <code class="docutils literal notranslate"><span class="pre">habituation</span></code> and <code class="docutils literal notranslate"><span class="pre">follow_the_light</span></code> and some
variables change in the later of them.
Apart from the task and the training protocol, there are other files in the <code class="docutils literal notranslate"><span class="pre">code</span></code> repository
(for creating sounds and plots and other helper files, we will talk about them later).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>code/
 __init__.py
 habituation.py
 follow_the_light.py
 training_protocol.py
 session_plot.py
 subject_plot.py
 online_plot.py
 softcode_functions.py
 sound_functions.py
 LICENSE
 README.md
</pre></div>
</div>
</section>
<section id="training-protocol">
<h3>Training Protocol</h3>
<p>The training protocol must be in a file named <code class="docutils literal notranslate"><span class="pre">training_protocol.py</span></code> inside your code folder. The structure of the
training protocol is the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">village.classes.training</span><span class="w"> </span><span class="kn">import</span> <span class="n">Training</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TrainingProtocol</span><span class="p">(</span><span class="n">Training</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines the training protocol for animal behavior experiments.</span>

<span class="sd">    The training protocol is run every time a task is finished and it determines:</span>
<span class="sd">    1. Which new task is scheduled for the subject</span>
<span class="sd">    2. How training variables change based on performance metrics</span>


<span class="sd">    Required methods to implement:</span>
<span class="sd">    - __init__: Initialize the training protocol</span>
<span class="sd">    - default_training_settings: Define initial parameters. It is called when creating a new subject.</span>
<span class="sd">    - update_training_settings: Update parameters after each session.</span>

<span class="sd">    Optional method:</span>
<span class="sd">    - gui_tabs: Organize the variables in custom GUI tabs</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the training protocol.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</pre></div>
</div>
<p>First we import the class Training which our custom class TrainingProtocol will depend on.
We initialize the class and call the super().<strong>init</strong>()</p>
</section>
<section id="the-default-training-settings-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">default_training_settings()</span></code> Method</h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">default_training_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define all initial training parameters for new subjects.</span>

<span class="sd">        This method is called when creating a new subject, and these parameters</span>
<span class="sd">        are saved as the initial values for that subject.</span>

<span class="sd">        Required parameters:</span>
<span class="sd">        - next_task (str): Name of the next task to run</span>
<span class="sd">        - refractory_period (int): Waiting time in seconds between sessions</span>
<span class="sd">        - minimum_duration (int): Minimum time in seconds for the task before door2 opens</span>
<span class="sd">        - maximum_duration (int): Maximum time in seconds before task stops automatically</span>

<span class="sd">        Additional parameters:</span>
<span class="sd">        You can define any additional parameters needed for your specific tasks.</span>
<span class="sd">        These can be modified between sessions based on subject performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Required parameters for any training protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">next_task</span> <span class="o">=</span> <span class="s2">&quot;Habituation&quot;</span>  <span class="c1"># Next task to run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">refractory_period</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">4</span>  <span class="c1"># 4 hours between sessions of the same subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">minimum_duration</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># Minimum duration of 10 min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">maximum_duration</span> <span class="o">=</span> <span class="mi">900</span>  <span class="c1"># Maximum duration of 15 min</span>

        <span class="c1"># Task-specific parameters</span>
        <span class="c1"># (can be modified between sessions or set when the task is run manually)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span> <span class="o">=</span> <span class="mf">0.08</span>  <span class="c1"># Reward volume in milliliters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Current training stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span> <span class="o">=</span> <span class="mi">255</span> <span class="c1"># High light intensity in the port (0-255)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_low</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Low light intensity in the port (0-255)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">trial_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left_easy&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;right_easy&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;left_hard&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;right_hard&quot;</span><span class="p">]</span>  <span class="c1"># Possible trial types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">punishment_time</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Time in seconds for punishment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">iti_time</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Inter-trial interval in seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">response_time</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Time in seconds to respond before timeout</span>
</pre></div>
</div>
<p>We set the value of next_task to Habituation so this would be the first task that the
subject will perform.
The refractory period is the time a subject needs to wait until be allowed to enter the
behavioral box again. This period is important to prevent some animals monipolize the
use of the behavioral box. It can be changed depending on the number of subjects in
the systems and the duration of the tasks.
When the minimum_duration is reached door2 is opened so is a choice of the animal if it
continues performing the tasks of it goes out. When the maximum duration is reached,
the tasks stops and the system waits for the animal to come back home. (Door2 is already
open as maximum_duration must be larger or equal to minimum_duration).</p>
<section id="the-update-training-settings-method">
<h4>The <code class="docutils literal notranslate"><span class="pre">update_training_settings()</span></code> Method</h4>
<p>This method is essential for training progression. It runs every time a session finishes
and determines how the subject should progress through the training protocol.</p>
<p>Heres an example implementation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">update_training_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update training parameters after each session.</span>

<span class="sd">        This method is called when a session finishes and determines how</span>
<span class="sd">        the subject progresses through the training protocol.</span>

<span class="sd">        Available data for decision-making:</span>
<span class="sd">        - self.subject (str): Name of the current subject</span>
<span class="sd">        - self.last_task (str): Name of the task that just finished</span>
<span class="sd">        - self.df (pd.DataFrame): DataFrame with all sessions data for this subject</span>

<span class="sd">        Example logic:</span>
<span class="sd">        - Progress from Habituation to FollowTheLight after 2 sessions with &gt;100 trials</span>
<span class="sd">        - Reduce reward amount as training progresses</span>
<span class="sd">        - Advance to stage 2 after two consecutive sessions in FollowTheLight with &gt;85% performance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_task</span> <span class="o">==</span> <span class="s2">&quot;Habituation&quot;</span><span class="p">:</span>
            <span class="c1"># Get all Habituation sessions from the dataframe</span>
            <span class="n">df_habituation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Habituation&quot;</span><span class="p">]</span>

            <span class="c1"># Check if the animal completed at least 2 Habituation sessions</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_habituation</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Get data from the last session</span>
                <span class="n">df_last_session</span> <span class="o">=</span> <span class="n">df_habituation</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">trials_last_session</span> <span class="o">=</span> <span class="n">df_last_session</span><span class="p">[</span><span class="s2">&quot;trial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Progress to next task if criteria met (&gt;100 trials)</span>
                <span class="k">if</span> <span class="n">trials_last_session</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">next_task</span> <span class="o">=</span> <span class="s2">&quot;FollowTheLight&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span> <span class="o">=</span> <span class="mf">0.07</span>  <span class="c1"># Decrease reward</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_task</span> <span class="o">==</span> <span class="s2">&quot;FollowTheLight&quot;</span><span class="p">:</span>
            <span class="c1"># Get all FollowTheLight sessions</span>
            <span class="n">df_follow_the_light</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FollowTheLight&quot;</span><span class="p">]</span>

            <span class="c1"># Check if at least 2 sessions completed</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_follow_the_light</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Get data from the last two sessions</span>
                <span class="n">df_last_session</span> <span class="o">=</span> <span class="n">df_follow_the_light</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">df_previous_session</span> <span class="o">=</span> <span class="n">df_follow_the_light</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># Calculate performance metrics</span>
                <span class="n">performance_last_session</span> <span class="o">=</span> <span class="n">df_last_session</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">performance_previous_session</span> <span class="o">=</span> <span class="n">df_previous_session</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">trials_last_session</span> <span class="o">=</span> <span class="n">df_last_session</span><span class="p">[</span><span class="s2">&quot;trial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">trials_previous_session</span> <span class="o">=</span> <span class="n">df_previous_session</span><span class="p">[</span><span class="s2">&quot;trial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Advance to stage 2 if criteria met</span>
                <span class="c1"># (&gt;85% correct in two sessions with &gt;100 trials each)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">performance_last_session</span> <span class="o">&gt;=</span> <span class="mf">0.85</span> <span class="ow">and</span>
                    <span class="n">performance_previous_session</span> <span class="o">&gt;=</span> <span class="mf">0.85</span> <span class="ow">and</span>
                    <span class="n">trials_last_session</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span>
                    <span class="n">trials_previous_session</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># Decrease reward</span>
</pre></div>
</div>
</section>
<section id="the-optional-gui-tabs-method">
<h4>The optional <code class="docutils literal notranslate"><span class="pre">gui_tabs()</span></code> Method</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">gui_tabs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is used to define the organization of the settings in the GUI.</span>
<span class="sd">        Whatever that is not defined here will be placed in the &quot;General&quot; tab.</span>

<span class="sd">        They need to have the same name as your settings variables.</span>
<span class="sd">        You can use the &#39;Hide&#39; tab to hide a setting from the GUI.</span>

<span class="sd">        Items in the lists need to have the same name as your settings variables.</span>

<span class="sd">        You can also restrict the possible values for each setting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gui_tabs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Port_variables&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;reward_amount_ml&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;light_intensity_high&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;light_intensity_low&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Other_variables&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;trial_types&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;punishment_time&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;iti_time&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;response_time&quot;</span><span class="p">],</span>
        <span class="p">}</span>


        <span class="c1"># define possible values for each variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_tabs_restricted</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;trial_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;left_easy&quot;</span><span class="p">,</span> <span class="s2">&quot;right_easy&quot;</span><span class="p">,</span> <span class="s2">&quot;left_hard&quot;</span><span class="p">,</span> <span class="s2">&quot;right_hard&quot;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>If you have a lot of variables in your settings, you may want to organize them in tabs
when they appear in the GUI when you are going to run the task manually.
Also in this case we are restricting the possible values for trial_types, so when
we run the task from the GUI, if we want to change this value, a dropbox menu with
those 4 options will appear.</p>
</section>
</section>
<section id="customizing-your-training-protocol">
<h3>Customizing Your Training Protocol</h3>
<p>When creating your own training protocol, you can fully customize:</p>
<ol class="arabic simple">
<li><p><strong>Progression between tasks</strong>: Define when an animal should move to the next task or
return to a simpler one.</p></li>
<li><p><strong>Parameter adjustment</strong>: Modify parameters such as reward amount, session duration,
or task difficulty.</p></li>
<li><p><strong>Advancement criteria</strong>: Set performance metrics (accuracy, number of trials, etc.)
to determine when an animal is ready to advance.</p></li>
</ol>
<p>Remember that you must always implement at least the three required methods (<code class="docutils literal notranslate"><span class="pre">__init__</span></code>, <code class="docutils literal notranslate"><span class="pre">default_training_settings</span></code>,
and <code class="docutils literal notranslate"><span class="pre">update_training_settings</span></code>) in your <code class="docutils literal notranslate"><span class="pre">TrainingProtocol</span></code> class.</p>
</section>
<section id="tasks">
<h3>Tasks</h3>
<p>To create a task, create a Python file, and within it, a class with the tasks name,
inheriting functionality from the generic <code class="docutils literal notranslate"><span class="pre">Task</span></code> class. This process is straightforward.
Lets look at an example:</p>
<p>Lets explore the task <code class="docutils literal notranslate"><span class="pre">habituation.py</span></code> inside your code folder. The structure of the
task is the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">village.classes.task</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Task</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">village.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">manager</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Habituation</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines the task.</span>

<span class="sd">    Required methods to implement:</span>
<span class="sd">    - __init__: Initialize the task</span>
<span class="sd">    - start: Called when the task starts.</span>
<span class="sd">    - create_trial: Called once per trial to create the state machine.</span>
<span class="sd">    - after_trial: Called once after each trial to register the values in the .csv file.</span>
<span class="sd">    - close: Called when the task is finished.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the training protocol. The text in the self.info variable</span>
<span class="sd">        will be shown when the task is selected in the GUI to be run manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        Habituation Task</span>
<span class="s2">        -------------------</span>

<span class="s2">        This task is a simple visual task where the mouse has</span>
<span class="s2">        to poke in illuminated ports.</span>
<span class="s2">        The center port illuminates when a trial starts.</span>
<span class="s2">        After the center port is poked,</span>
<span class="s2">        both side ports are illuminated and give reward.</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The task is named Habituation. It is initialized with <strong>init</strong>, and we acquire all the properties of the generic Task class using super().<strong>init</strong>(). The naming conventions follow Python standards: CamelCase for class names and lower_case for filenames and function names.
Certain methods must be implemented in your class. These methods are:</p>
</section>
<section id="the-start-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">start()</span></code> Method</h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called when the task starts.</span>
<span class="sd">        It is used to calculate values needed for the task.</span>
<span class="sd">        The following variables are accessible by default:</span>
<span class="sd">        - self.bpod: (Bpod object)</span>
<span class="sd">        - self.name: (str) the name of the task</span>
<span class="sd">                (it is the name of the class, in this case Habituation)</span>
<span class="sd">        - self.subject: (str) the name of the subject performing the task</span>
<span class="sd">        - self.current_trial: (int) the current trial number starting from 1</span>
<span class="sd">        - self.system_name: (str) the name of the system as defined in the</span>
<span class="sd">                                tab settings of the GUI</span>
<span class="sd">        - self.settings: (Settings object) the settings defined in training_protocol.py</span>
<span class="sd">        - self.trial_data: (dict) information about the current trial</span>
<span class="sd">        - self.force_stop: (bool) if made true the task will stop</span>

<span class="sd">        Al the variables created in training_protocol.py are accessible.</span>
<span class="sd">        - self.settings.reward_amount_ml: reward volume</span>
<span class="sd">        - self.settings.stage: current training stage</span>
<span class="sd">        - self.settings.light_intensity_high: high light intensity</span>
<span class="sd">        - self.settings.light_intensity_low: low light intensity</span>
<span class="sd">        - self.settings.trial_types: possible trial types</span>
<span class="sd">        - self.settings.punishment_time: punishment duration</span>
<span class="sd">        - self.settings.iti_time: inter-trial interval</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First we calculate the time that the valves (or pumps) need to open to deliver</span>
        <span class="c1"># the reward amount</span>
        <span class="c1"># Make sure to calibrate the valves before using this function, otherwise</span>
        <span class="c1"># it will return an Exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_valve_opening_time</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">water_calibration</span><span class="o">.</span><span class="n">get_valve_time</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_valve_opening_time</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">water_calibration</span><span class="o">.</span><span class="n">get_valve_time</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-create-trial-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">create_trial()</span></code> Method</h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">create_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called once per trial, first it modifies variables and then</span>
<span class="sd">        sends the state machine to the bpod that will run the trial.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># &#39;ready_to_initiate&#39;: state that turns on the central port light and</span>
        <span class="c1"># waits for a poke in the central port (Port2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;ready_to_initiate&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Port2In</span><span class="p">:</span> <span class="s2">&quot;stimulus_state&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">)],</span>
        <span class="p">)</span>

        <span class="c1"># &#39;stimulus_state&#39;: state that turns on the side ports and</span>
        <span class="c1"># waits for a poke in one of the side ports (Port1 or Port3)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;stimulus_state&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">Port1In</span><span class="p">:</span> <span class="s2">&quot;reward_state_left&quot;</span><span class="p">,</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">Port3In</span><span class="p">:</span> <span class="s2">&quot;reward_state_right&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">),</span>
                <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># &#39;reward_state_left&#39; and &#39;reward_state_right&#39;: states that deliver the reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;reward_state_left&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_valve_opening_time</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;exit&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">Valve1</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;reward_state_right&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">right_valve_opening_time</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;exit&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">Valve3</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-after-trial-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">after_trial()</span></code> Method</h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">after_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here you can register all the values you need to save for each trial.</span>
<span class="sd">        It is essential to always include a variable named water, which stores the</span>
<span class="sd">        amount of water consumed during each trial.</span>
<span class="sd">        The system will calculate the total water consumption in each session</span>
<span class="sd">        by summing this variable.</span>
<span class="sd">        If the total water consumption falls below a certain threshold,</span>
<span class="sd">        an alarm will be triggered.</span>
<span class="sd">        This threshold can be adjusted in the Settings tab of the GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_value</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-close-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">close()</span></code> Method</h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here you can perform any actions you want to take once the task is completed,</span>
<span class="sd">        such as sending a message via email or Slack, creating a plot, and more.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="the-followthelight-task">
<h3>The FollowTheLight Task</h3>
<p>Now you can explore the more complex FollowTheLight Task, where we use other variables that
were created in the settings training_protocol.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">village.classes.task</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Task</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">village.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">manager</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FollowTheLight</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        Follow The Light Task</span>
<span class="s2">        -------------------</span>

<span class="s2">        This task is a simple visual task where the mouse has</span>
<span class="s2">        to poke the center port to start a trial.</span>
<span class="s2">        After the center port is poked,</span>
<span class="s2">        one of the two side ports will be illuminated.</span>
<span class="s2">        If the mouse licks the correct side port, it receives a reward.</span>
<span class="s2">        If the mouse licks the wrong side port, it receives a punishment.</span>

<span class="s2">        It contains 2 training stages:</span>
<span class="s2">        - Training stage 1: Only one side port is illuminated and gives reward.</span>
<span class="s2">                            No punishment is given, and the mouse can choose again.</span>
<span class="s2">        - Training stage 2: Both ports are illuminated with different intensity.</span>
<span class="s2">                            Brighter port gives reward, the other one gives punishment.</span>

<span class="s2">        The progression through the stages is defined in the training_settings.py file.</span>
<span class="s2">        &quot;&quot;&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Al the variables created in training_protocol.py are accessible.</span>
<span class="sd">        - self.settings.reward_amount_ml: reward volume</span>
<span class="sd">        - self.settings.stage: current training stage</span>
<span class="sd">        - self.settings.light_intensity_high: high light intensity</span>
<span class="sd">        - self.settings.light_intensity_low: low light intensity</span>
<span class="sd">        - self.settings.trial_types: possible trial types</span>
<span class="sd">        - self.settings.punishment_time: punishment duration</span>
<span class="sd">        - self.settings.iti_time: inter-trial interval</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First we calculate the time that the valves (or pumps) need to open to deliver</span>
        <span class="c1"># the reward amount</span>
        <span class="c1"># Make sure to calibrate the valves before using this function, otherwise</span>
        <span class="c1"># it will return an Exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_valve_opening_time</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">water_calibration</span><span class="o">.</span><span class="n">get_valve_time</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_valve_opening_time</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">water_calibration</span><span class="o">.</span><span class="n">get_valve_time</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span>
        <span class="p">)</span>

        <span class="c1"># determine if punishment will be used depending on stage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># no punishment is used, let the mouse choose again</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">punish_condition</span> <span class="o">=</span> <span class="s2">&quot;stimulus_state&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># punishment is used</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">punish_condition</span> <span class="o">=</span> <span class="s2">&quot;punish_state&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">create_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Pick a trial type at random</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">trial_types</span><span class="p">)</span>

        <span class="c1"># Set the variables for the stimulus states and the possible choices</span>
        <span class="c1"># based on the trial type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;left&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;hard&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_low</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_poke_action</span> <span class="o">=</span> <span class="s2">&quot;reward_state&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valve_to_open</span> <span class="o">=</span> <span class="n">Output</span><span class="o">.</span><span class="n">Valve1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valve_opening_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_valve_opening_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_poke_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">punish_condition</span>

        <span class="k">elif</span> <span class="s2">&quot;right&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;hard&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_low</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_poke_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">punish_condition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_poke_action</span> <span class="o">=</span> <span class="s2">&quot;reward_state&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valve_to_open</span> <span class="o">=</span> <span class="n">Output</span><span class="o">.</span><span class="n">Valve3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valve_opening_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_valve_opening_time</span>


        <span class="c1"># &#39;ready_to_initiate&#39; state that waits for the poke in the middle port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;ready_to_initiate&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Port2In</span><span class="p">:</span> <span class="s2">&quot;stimulus_state&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[(</span><span class="n">Output</span><span class="o">.</span><span class="n">PWM2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">light_intensity_high</span><span class="p">)],</span>
        <span class="p">)</span>

        <span class="c1"># &#39;stimulus_state&#39; lights the side ports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;stimulus_state&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">timer_for_response</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">Port1In</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_poke_action</span><span class="p">,</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">Port3In</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_poke_action</span><span class="p">,</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stimulus_state_output</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;reward_state&#39; delivers the reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;reward_state&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_opening_time</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;iti_state&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_to_open</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># &#39;punish_state&#39; waits during the punishment time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;punish_state&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">punishment_time</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;iti_state&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>

        <span class="c1"># &#39;iti_state&#39; waits for certain time before starting the next trial</span>
        <span class="c1"># (inter-trial interval)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpod</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
            <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;iti_state&quot;</span><span class="p">,</span>
            <span class="n">state_timer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">iti_time</span><span class="p">,</span>
            <span class="n">state_change_conditions</span><span class="o">=</span><span class="p">{</span><span class="n">Event</span><span class="o">.</span><span class="n">Tup</span><span class="p">:</span> <span class="s2">&quot;exit&quot;</span><span class="p">},</span>
            <span class="n">output_actions</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">after_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># First, we calculates the performance of a trial, comparing the trial type</span>
        <span class="c1"># to the first port that the mouse poked.</span>
        <span class="c1"># We can access the trial information in self.trial_data</span>

        <span class="c1"># get the side port that the mouse poked first</span>
        <span class="n">first_poke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_first_occurrence</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trial_data</span><span class="p">[</span><span class="s2">&quot;ordered_list_of_events&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;Port1In&quot;</span><span class="p">,</span> <span class="s2">&quot;Port3In&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># check if the mouse poked the correct port</span>
        <span class="k">if</span> <span class="n">first_poke</span> <span class="o">==</span> <span class="s2">&quot;Port1In&quot;</span> <span class="ow">and</span> <span class="s2">&quot;left&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">first_poke</span> <span class="o">==</span> <span class="s2">&quot;Port3In&quot;</span> <span class="ow">and</span> <span class="s2">&quot;right&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">=</span>  <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">=</span>  <span class="kc">False</span>

        <span class="c1"># register the amount of water given to the mouse in this trial</span>
        <span class="c1"># (this is always mandatory)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_value</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reward_amount_ml</span><span class="p">)</span>

        <span class="c1"># we will also record the trial type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_value</span><span class="p">(</span><span class="s2">&quot;trial_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_trial_type</span><span class="p">)</span>

        <span class="c1"># we will also record if the trial was correct or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_value</span><span class="p">(</span><span class="s2">&quot;correct&quot;</span><span class="p">,</span> <span class="n">correct</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">find_first_occurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_list</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to find the first occurrence of any target event in the list.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_list: List of events</span>
<span class="sd">            targets: List of target events to look for</span>

<span class="sd">        Returns:</span>
<span class="sd">            The first target event found, or &quot;NaN&quot; if none are found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event</span>
        <span class="k">return</span> <span class="s2">&quot;NaN&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="test.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Test a Training Protocol</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="use.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Use an Existing Training Protocol</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Rafael Marin, Balma Serrano, Hernando Vergara
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Create a Training Protocol</a><ul>
<li><a class="reference internal" href="#project-structure">Project Structure</a></li>
<li><a class="reference internal" href="#code-organization">Code Organization</a><ul>
<li><a class="reference internal" href="#examples-of-code-structure">Examples of Code Structure</a></li>
<li><a class="reference internal" href="#training-protocol">Training Protocol</a></li>
<li><a class="reference internal" href="#the-default-training-settings-method">The <code class="docutils literal notranslate"><span class="pre">default_training_settings()</span></code> Method</a><ul>
<li><a class="reference internal" href="#the-update-training-settings-method">The <code class="docutils literal notranslate"><span class="pre">update_training_settings()</span></code> Method</a></li>
<li><a class="reference internal" href="#the-optional-gui-tabs-method">The optional <code class="docutils literal notranslate"><span class="pre">gui_tabs()</span></code> Method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customizing-your-training-protocol">Customizing Your Training Protocol</a></li>
<li><a class="reference internal" href="#tasks">Tasks</a></li>
<li><a class="reference internal" href="#the-start-method">The <code class="docutils literal notranslate"><span class="pre">start()</span></code> Method</a></li>
<li><a class="reference internal" href="#the-create-trial-method">The <code class="docutils literal notranslate"><span class="pre">create_trial()</span></code> Method</a></li>
<li><a class="reference internal" href="#the-after-trial-method">The <code class="docutils literal notranslate"><span class="pre">after_trial()</span></code> Method</a></li>
<li><a class="reference internal" href="#the-close-method">The <code class="docutils literal notranslate"><span class="pre">close()</span></code> Method</a></li>
<li><a class="reference internal" href="#the-followthelight-task">The FollowTheLight Task</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=b6a3a34b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>